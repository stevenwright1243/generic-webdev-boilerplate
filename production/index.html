<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello World</title>

    <script>
    function getAjaxRev(url, success) {
      var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
      xhr.open('GET', url);
      xhr.onreadystatechange = function() {
        if (xhr.readyState>3 && xhr.status==200) success(xhr.responseText);
      };
      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
      xhr.send();
      return xhr;
      }

    getAjaxRev('assets/rev-manifest.json', function(data) {

      var json = JSON.parse(data);

      // es6 polyfill for endsWith()  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith#Polyfill
      if (!String.prototype.endsWith) {
        String.prototype.endsWith = function(searchString, position) {
          var subjectString = this.toString();
          if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {
            position = subjectString.length;
          }
          position -= searchString.length;
          var lastIndex = subjectString.lastIndexOf(searchString, position);
          return lastIndex !== -1 && lastIndex === position;
        };
      }
      Object.keys(json).forEach(function(key) {
        var src = json[key];
        if (src.endsWith('css')) {
          var head = document.getElementsByTagName('head')[0];
          var element = document.createElement('link');
          element.rel = 'stylesheet';
          element.href = src;
          head.appendChild(element);
        } else if (src.endsWith('js')) {
          var scripts = document.getElementsByTagName('script')[0];
          var element = document.createElement('script');
          element.async = true;
          element.src = src;
          scripts.parentNode.insertBefore(element, scripts);
        } else {
          console.error('File from rev-manifest does not end in either "js" or "css"');
        }
      });
    });
    </script>
  </head>
  <body>
    <h1 id="heading">Hello World</h1>
  </body>
</html>
